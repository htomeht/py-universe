<?xml version="1.0"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <title></title>
        <style type="text/css">
.Abstract_Heading {
    color: #000000;
    font-family: 'Helvetica-Bold', 'Helvetica';
    font-size: 12.00pt;
    font-style: normal;
    font-variant: normal;
    font-weight: bold;
    letter-spacing: 0;
    line-height: 1.17;
    margin-bottom: 0.000000pt;
    margin-left: 0.00pt;
    margin-right: 0.00pt;
    margin-top: 0.000000pt;
    padding-bottom: 5.000000pt;
    padding-top: 24.000000pt;
    text-align: center;
    text-decoration: none;
    text-indent: 0.00pt;
    text-transform: none;
    vertical-align: 0.000000em;
}
.Author {
    color: #000000;
    font-family: 'Helvetica', 'Helvetica';
    font-size: 12.00pt;
    font-style: normal;
    font-variant: normal;
    font-weight: normal;
    letter-spacing: 0;
    line-height: 1.40;
    margin-bottom: 0.000000pt;
    margin-left: 0.00pt;
    margin-right: 0.00pt;
    margin-top: 0.000000pt;
    padding-bottom: 12.000000pt;
    padding-top: 0.000000pt;
    text-align: center;
    text-decoration: none;
    text-indent: 0.00pt;
    text-transform: none;
    vertical-align: 0.000000em;
}
.Title {
    color: #000000;
    font-family: 'Helvetica-Bold', 'Helvetica';
    font-size: 18.00pt;
    font-style: normal;
    font-variant: normal;
    font-weight: bold;
    letter-spacing: 0;
    line-height: 1.22;
    margin-bottom: 0.000000pt;
    margin-left: 0.00pt;
    margin-right: 0.00pt;
    margin-top: 0.000000pt;
    padding-bottom: 12.000000pt;
    padding-top: 12.000000pt;
    text-align: center;
    text-decoration: none;
    text-indent: 0.00pt;
    text-transform: none;
    vertical-align: 0.000000em;
}
.Abstract {
    color: #000000;
    font-family: 'Helvetica', 'Helvetica';
    font-size: 12.00pt;
    font-style: normal;
    font-variant: normal;
    font-weight: normal;
    letter-spacing: 0;
    line-height: 1.17;
    margin-bottom: 0.000000pt;
    margin-left: 54.00pt;
    margin-right: 54.00pt;
    margin-top: 0.000000pt;
    padding-bottom: 37.000000pt;
    padding-top: 12.000000pt;
    text-align: left;
    text-decoration: none;
    text-indent: 0.00pt;
    text-transform: none;
    vertical-align: 0.000000em;
}
.Footnote_Text {
    color: #000000;
    font-family: 'Helvetica', 'Helvetica';
    font-size: 10.00pt;
    font-style: normal;
    font-variant: normal;
    font-weight: normal;
    letter-spacing: 0;
    line-height: 1.20;
    margin-bottom: 0.000000pt;
    margin-left: 0.00pt;
    margin-right: 0.00pt;
    margin-top: 0.000000pt;
    padding-bottom: 10.000000pt;
    padding-top: 0.000000pt;
    text-align: left;
    text-decoration: none;
    text-indent: 0.00pt;
    text-transform: none;
    vertical-align: 0.000000em;
}
.Section_Heading {
    color: #000000;
    font-family: 'Helvetica-Bold', 'Helvetica';
    font-size: 12.00pt;
    font-style: normal;
    font-variant: normal;
    font-weight: bold;
    letter-spacing: 0;
    line-height: 1.17;
    margin-bottom: 0.000000pt;
    margin-left: 0.00pt;
    margin-right: 0.00pt;
    margin-top: 0.000000pt;
    padding-bottom: 12.000000pt;
    padding-top: 24.000000pt;
    text-align: left;
    text-decoration: none;
    text-indent: 0.00pt;
    text-transform: none;
    vertical-align: 0.000000em;
}
.Body {
    color: #000000;
    font-family: 'Helvetica', 'Helvetica';
    font-size: 12.00pt;
    font-style: normal;
    font-variant: normal;
    font-weight: normal;
    letter-spacing: 0;
    line-height: 1.17;
    margin-bottom: 0.000000pt;
    margin-left: 0.00pt;
    margin-right: 0.00pt;
    margin-top: 0.000000pt;
    padding-bottom: 12.000000pt;
    padding-top: 0.000000pt;
    text-align: left;
    text-decoration: none;
    text-indent: 0.00pt;
    text-transform: none;
    vertical-align: 0.000000em;
}
.Normal {
    vertical-align: top;
}
.table_cell_style_default {
    background-color: transparent;
}
.console {
    color: #000000;
    font-family: 'Courier-Bold', 'Courier';
    font-size: 12.00pt;
    font-style: normal;
    font-variant: normal;
    font-weight: bold;
    letter-spacing: 0;
    line-height: 1.17;
    text-decoration: none;
    text-transform: none;
    vertical-align: 0.000000em;
}
.Table {
    background-color: transparent;
    border-collapse: collapse;
}
.FootnoteRegion {
    border-bottom-width: 0;
    border-color: #7f7f7f;
    border-left-width: 0;
    border-right-width: 0;
    border-style: solid;
    border-top-width: thin;
    margin-top: 1em;
    padding-top: 0.5em;
}

        </style>
  </head>
  <body style="margin: 90pt 90pt 90pt 90pt;">
    <div style="margin : 0pt 18pt 0pt 18pt; ">
      <p style="padding-top: 0pt; vertical-align: 0.000000em; " class="Title ">Durus: A Persistence System for Python</p>
      <p style="padding-bottom: 0pt; vertical-align: 0.000000em; " class="Author ">David Binger</p>
    </div>
    <div style="margin : 0pt 18pt 0pt 18pt; ">
      <p style="padding-top: 0pt; vertical-align: 0.000000em; " class="Author ">MEMS Exchange</p>
      <p class="Abstract_Heading " style="vertical-align: 0.000000em; ">Abstract</p>
      <p class="Abstract " style="vertical-align: 0.000000em; ">This paper describes Durus, a package for transactional maintenance of persistent graphs of Python instances.</p>
      <p class="Section_Heading " style="vertical-align: 0.000000em; ">Background</p>
      <p class="Body " style="vertical-align: 0.000000em; ">The MEMS Exchange software development team developed Durus after using ZODB successfully for three years. &#xA0;We were very satisfied by the general architecture used by ZODB, but were also aware that much of the complexity of the ZODB source code existed to support features that the MEMS Exchange would never use: most notably the support for multiple threads in a process. &#xA0;Durus is primarily a re-implementation of the subset ZODB architecture that we use for our web applications.</p>
      <p class="Section_Heading " style="vertical-align: 0.000000em; ">The Target Application</p>
      <p class="Body " style="vertical-align: 0.000000em; ">Although Durus can be useful in a wide variety of applications, it was written with a specific target in mind, and it may help the reader to know the general context. &#xA0;In the picture that follows, each oval represents a separate long-running process.</p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">When an HTTP request arrives, the HTTP Server converts it to an SCGI request and passes it along to an SCGI server that is listening on a port on the local interface.</span>
        <a href="#Footnote1" style="font-size: 7.92pt; vertical-align: 0.500000em; ">1</a>
        <span style="vertical-align: 0.000000em; "> &#xA0;</span>
      </p>
      <p class="Body " style="vertical-align: 0.000000em; ">The SCGI Server manages a pool of request-handler child processes. &#xA0;When an SCGI request arrives from the HTTP server, the SCGI Server passes the request with a socket descriptor for the connection to a request-handler that is not busy.</p>
      <p class="Body " style="vertical-align: 0.000000em;  visibility: hidden; ">&#xA0;</p>
      <p class="Body " style="text-align:center">
        <img src="DurusApplication.png" alttext="Durus application architecture" />
      </p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">The main application-level code runs in each of a pool of request-handler processes. &#xA0;Each request-handler process handles one request at a time.</span>
        <a href="#Footnote2" style="font-size: 7.92pt; vertical-align: 0.500000em; ">2</a>
        <span style="vertical-align: 0.000000em; "> &#xA0;Each response is written back (through the received socket descriptor) to the HTTP Server, which transmits to the client, perhaps through an SSL connection.</span>
      </p>
      <p class="Body " style="vertical-align: 0.000000em; ">In the course of preparing a response, the request-handler processes examine and sometimes change persistent instances. &#xA0;To accomplish this, each request-handler maintains a connection to a shared Durus storage server. &#xA0;The connection can be used by Durus to retrieve a persistent instance with a given identification number. &#xA0;To limit traffic with the storage server, each connection maintains a cache of loaded instances. &#xA0;In the course of processing a request, a request-handler may change objects in the cache. &#xA0;When the response is ready, the request handler uses the connection to commit these changes (or abort them, if something went wrong).</p>
      <p class="Body " style="vertical-align: 0.000000em; ">In summary, we have a shared memory with multiple caches. &#xA0;Here, as in similar situations, the tricky part is in maintaining some sort of data consistency, and that is the primary purpose of Durus.</p>
      <p class="Section_Heading " style="vertical-align: 0.000000em; ">Pickles for Persistence</p>
      <p class="Body " style="vertical-align: 0.000000em; ">Durus stores instances in a file so that they can be used later. &#xA0;Instances must be converted to strings before they can be written to a file. &#xA0;Durus uses the Python pickler for this serialization. &#xA0;The pickler is powerful in that it can serialize instance graphs, even if they contain circular references. &#xA0;In Durus, we want to manage change in a rather large instance graph, with, for example, hundreds of thousands of instances. &#xA0;The pickle of the whole instance graph (our &#x201C;universe&#x201D;) might be hundreds of MB: too big for fast writes.</p>
      <p class="Body " style="vertical-align: 0.000000em; ">Fortunately, the pickler includes hooks that make it possible to put bounds on the part of the instance graph that is actually serialized. &#xA0;In Durus, the pickler behaves specially whenever it encounters a reference to an instance of the &#x201C;Persistent&#x201D; class (described in detail in a section below). &#xA0;Instead of crawling forward and including the instance in the pickle in the usual way, a reference to a Persistent instance is replaced with an identifier that can be used to locate that instance later. &#xA0;If the referred-to instance does not already have an assigned identifier, the pickler assigns one.</p>
      <p class="Body " style="vertical-align: 0.000000em; ">The critical benefit of this behavior is that it effectively partitions an instance graph into distinct components, one component for each Persistent instance, and with a distinct identifier for each instance. &#xA0;With this behavior, we can record a change in one Persistent instance by writing the corresponding pickle instead of pickling the universe. &#xA0;Moreover, we can unpickle a single Persistent instance&#x2019;s state when we need it instead of being forced to load the whole universe of instances. &#xA0;In Durus, the state of a Persistent instance is not loaded until it is used, as, for example, &#xA0;when application code looks for the value of an attribute.</p>
      <p class="Section_Heading " style="vertical-align: 0.000000em; ">Accessing Stored Instances</p>
      <p class="Body " style="vertical-align: 0.000000em; ">In Durus, the Storage class provides an index for all these Persistent instance pickles: you can retrieve the pickle for a given identifier. &#xA0;The FileStorage class implements the Storage methods and keeps all of the pickles on disk in a single file. &#xA0;When the FileStorage instance is constructed in a Python program, it traverses the file and builds a dictionary that maps each instance identifier to the offset in the file where that instance&#x2019;s pickle is stored. &#xA0;If the file is extremely large, then traversing the file might be slow. &#xA0;If the number of instances is extremely large, then the dictionary mapping instance identifiers to offsets might use an unacceptable amount of memory. &#xA0;The limits will vary from one machine to another, and on specific application requirements. &#xA0;For a point of reference, the MEMS Exchange storage file is about 130 MB, with approximately 350,000 Persistent instances, and it runs nicely.</p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">Only one FileStorage can have a storage file open in read-write mode. &#xA0;The FileStorage constructor locks the file to make sure that this rule is followed. &#xA0;In the MEMS Exchange application, however, we need to support read-write mode from multiple connections (one in each request handler). &#xA0;Durus provides the StorageServer class for to support sharing. &#xA0;A StorageServer wraps a FileStorage instance and provides access for clients through TCP connections.</span>
        <a href="#Footnote3" style="font-size: 7.92pt; vertical-align: 0.500000em; ">3</a>
        <span style="vertical-align: 0.000000em; "> &#xA0;Each client, running in another process, has an instance of the ClientStorage class. &#xA0;The ClientStorage and StorageServer instances use a simple protocol to communicate over the TCP connection. &#xA0;As a result, each client process gets read-write Storage functionality. </span>
      </p>
      <p class="Body " style="vertical-align: 0.000000em; ">Durus applications always access storage through a Connection instance. &#xA0;Whereas the Storage provides indexed access to pickles, the Connection provides indexed access to Persistent instances. &#xA0; &#xA0;Multiple Connections, each with its own ClientStorage instance, may share Persistent instances through a common StorageServer.</p>
      <p class="Section_Heading " style="vertical-align: 0.000000em; ">Durus from the Command Line</p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">The Durus distribution includes a command line tool called &#x201C;durus&#x201D; that makes it easy to experiment. &#xA0;The &#x201C;</span>
        <span style="font-family: 'Helvetica-Bold', 'Helvetica'; font-weight: bold; line-height: 1.17; vertical-align: 0.000000em; ">durus -h&#x201D;</span>
        <span style="vertical-align: 0.000000em; "> command gives a help message, but there are just a few options that you need to know to get started. &#xA0;</span>
      </p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">First, &#x201C;</span>
        <span style="color: #000000; font-family: 'Helvetica-Bold', 'Helvetica'; font-size: 12.00pt; font-style: normal; font-variant: normal; font-weight: bold; letter-spacing: 0; line-height: 1.17; text-decoration: none; text-transform: none; vertical-align: 0.000000em; " class="console ">durus -s --file experiment.durus</span>
        <span style="font-family: 'Helvetica-Bold', 'Helvetica'; font-weight: bold; line-height: 1.17; vertical-align: 0.000000em; ">&#x201D;</span>
        <span style="vertical-align: 0.000000em; "> will start a Durus server using the file named &#x201C;experiment.durus&#x201D;. &#xA0; The server stays in the foreground and prints log messages that will help you see what it is doing. </span>
      </p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">Next, in a different shell, run &#x201C;</span>
        <span style="color: #000000; font-family: 'Helvetica-Bold', 'Helvetica'; font-size: 12.00pt; font-style: normal; font-variant: normal; font-weight: bold; letter-spacing: 0; line-height: 1.17; text-decoration: none; text-transform: none; vertical-align: 0.000000em; " class="console ">durus -c</span>
        <span style="vertical-align: 0.000000em; ">&#x201D;: this starts an interactive client with a connection to your storage server. &#xA0; If you are connecting for the time to the &#x201C;experiment.durus&#x201D; file, you will notice, when you start the client, that the server prints a message &#x201C;</span>
        <span style="color: #000000; font-family: 'Helvetica-Bold', 'Helvetica'; font-size: 12.00pt; font-style: normal; font-variant: normal; font-weight: bold; letter-spacing: 0; line-height: 1.17; text-decoration: none; text-transform: none; vertical-align: 0.000000em; " class="console ">Committed &#xA0; 1 objects 77 bytes</span>
        <span style="vertical-align: 0.000000em; ">&#x201D; indicating that a Persistent instance was saved to the file. &#xA0;This first instance, known as &#x201C;root&#x201D; is always created automatically on the first connection to a Storage. &#xA0;The root is a dictionary-like instance with instance identifier 0. &#xA0;As you start the client, a few useful names are made available in the local environment: &#xA0;notably &#x201C;root&#x201D; and &#x201C;connection&#x201D;. &#xA0;</span>
      </p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">Try making a change to root: &#xA0;for example, try &#x201C;</span>
        <span style="color: #000000; font-family: 'Helvetica-Bold', 'Helvetica'; font-size: 12.00pt; font-style: normal; font-variant: normal; font-weight: bold; letter-spacing: 0; line-height: 1.17; text-decoration: none; text-transform: none; vertical-align: 0.000000em; " class="console ">root[&#x2019;a&#x2019;] = 1</span>
        <span style="vertical-align: 0.000000em; ">&#x201D;. &#xA0;To save your change, use &#x201C;</span>
        <span style="color: #000000; font-family: 'Helvetica-Bold', 'Helvetica'; font-size: 12.00pt; font-style: normal; font-variant: normal; font-weight: bold; letter-spacing: 0; line-height: 1.17; text-decoration: none; text-transform: none; vertical-align: 0.000000em; " class="console ">connection.commit()</span>
        <span style="vertical-align: 0.000000em; ">&#x201D; . &#xA0;You should see, in the server shell window, a log message indicating that your change has been saved. &#xA0;Open a second connection (using &#x201C;</span>
        <span style="color: #000000; font-family: 'Helvetica-Bold', 'Helvetica'; font-size: 12.00pt; font-style: normal; font-variant: normal; font-weight: bold; letter-spacing: 0; line-height: 1.17; text-decoration: none; text-transform: none; vertical-align: 0.000000em; " class="console ">durus -c</span>
        <span style="vertical-align: 0.000000em; ">&#x201D;) in a third shell, and evaluate &#x201C;</span>
        <span style="color: #000000; font-family: 'Helvetica-Bold', 'Helvetica'; font-size: 12.00pt; font-style: normal; font-variant: normal; font-weight: bold; letter-spacing: 0; line-height: 1.17; text-decoration: none; text-transform: none; vertical-align: 0.000000em; " class="console ">root[&#x2019;a&#x2019;]</span>
        <span style="vertical-align: 0.000000em; ">&#x201D;. &#xA0;The result is 1. Stop both clients, restart one, and evaluate the same expression again. &#xA0;The result is still 1. &#xA0;Congratulations.</span>
      </p>
      <p class="Section_Heading " style="vertical-align: 0.000000em; ">Transactional Change Management</p>
      <p class="Body " style="vertical-align: 0.000000em; ">In the course of processing a request, a web application might modify dozens of Persistent instances. &#xA0;When the changes are all ready, the application calls the Connection&#x2019;s commit() method to save them to the database. &#xA0;To maintain the database in a consistent state, the changes must either be made in their entirety, or else not at all. &#xA0;We refer to a set of changes saved (or to be saved) all at once as a transaction. &#xA0;When the connection&#x2019;s commit() method is called, the connection sends the changes to the Storage, and the Storage appends a transaction record on the end of the file. &#xA0;The Storage makes sure that the the transaction records are written out and completed serially.</p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">If one connection&#x2019;s commit() completes while another connection&#x2019;s commit() is in progress, the second commit() will fail and raise a ConflictError exception. &#xA0;When this happens, the application must decide on the appropriate response.</span>
        <a href="#Footnote4" style="font-size: 7.92pt; vertical-align: 0.500000em; ">4</a>
        <span style="vertical-align: 0.000000em; "> </span>
      </p>
      <p class="Body " style="vertical-align: 0.000000em; ">Often, one connection saves a new version of a Persistent instance while another connection has the old version cached. &#xA0;It is important for every connection to have a mechanism for clearing out-of-date instances from the cache. &#xA0;To facilitate this, a transaction number is issued by the Storage every time a new transaction is committed. &#xA0;Each Connection keeps track of the last transaction number reported by the Storage. &#xA0;The Connection gets an updated report of the current transaction number every time it sends a request to the Storage. &#xA0;When the Storage reports the new transaction number, it also sends the identifiers of objects that have changed since the Connection&#x2019;s last report. &#xA0;If the Connection finds invalid objects in the cache while attempting to read or write from the Storage, a ConfictError exception is raised, and the application must determine the next step to take.</p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">Sometimes an application makes changes to instances in the connection&#x2019;s cache, and subsequently decides </span>
        <span style="font-family: 'Helvetica-Oblique', 'Helvetica'; font-style: italic; line-height: 1.17; vertical-align: 0.000000em; ">not </span>
        <span style="vertical-align: 0.000000em; ">to save the transaction. &#xA0;The connection has an abort() method to allow for this. &#xA0;Besides causing all changes to be undone, the abort() method synchronizes the connection with the Storage, so that any out-of-date instances are removed from the cache.</span>
      </p>
      <p class="Body " style="vertical-align: 0.000000em; ">After every attempt to process a request, the MEMS Exchange application calls commit() or abort(). &#xA0;When the request processing completed in the normal way, commit() is called because we want to save any changes that were made. &#xA0;If something went wrong while processing the request, abort() is called to make sure that the changes are forgotten.</p>
      <p class="Section_Heading " style="vertical-align: 0.000000em; ">The Persistent Class</p>
      <p class="Body " style="vertical-align: 0.000000em; ">The Persistent class plays a central role in Durus: &#xA0;it implements machinery that supports the tracking of change and cache behavior. &#xA0;Persistent instances have several attributes that are devoted to this purpose, but they are stored in slots, so the instance&#x2019;s __dict__ belongs entirely to application-level code. &#xA0;Persistent is a new-style class, and it implements a __new__() method. &#xA0;The __new__ method initializes the persistence attributes. &#xA0;This means that subclasses are not required to call Persistent.__init__(). &#xA0;</p>
      <p class="Body " style="vertical-align: 0.000000em; ">The &#x201C;state&#x201D; of a Persistent instance is the content of its __dict__: this is what gets pickled and stored. &#xA0;Sometimes, the Persistent instance is in a &#x201C;ghost&#x201D; state, meaning that contents of the pickle are not loaded into the __dict__. &#xA0;Whenever a program attempts to access or set an attribute on a Persistent instance that is in the ghost state, the Persistent class automatically loads the pickle behind the scenes. &#xA0; Whenever a value in the __dict__ is set, the instance is marked as changed, and will be saved if the transaction is committed.</p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">For the programmer, this behavior is all transparent. &#xA0;When you access or change attributes of a Persistent instance, you do it the same way you would with any object.</span>
        <a href="#Footnote5" style="font-size: 7.92pt; vertical-align: 0.500000em; ">5</a>
        <span style="vertical-align: 0.000000em; "> &#xA0;The main thing you need to remember is to call the connection&#x2019;s commit() when you want to save all changes, and abort() when you want to forget them.</span>
      </p>
      <p class="Body " style="vertical-align: 0.000000em; ">This automatic activity when you get or set attributes happens because Persistent implements __getattribute__() and __setattr__() methods. &#xA0;These methods are called with very high frequency in most Python programs, so it is important for them to be as fast as possible. &#xA0;To optimize these methods, the Python implementation of them is separated into a superclass of Persistent called PersistentBase, and Durus includes an alternative C implementation of PersistentBase that is used if it is installed. &#xA0;</p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">An application may sometimes need to change the state of a Persistent instance without setting an attribute. &#xA0;For example, suppose a Persistent instance has a &#x2018;data&#x2019; attribute whose value (loaded from the pickle) is a list. &#xA0;An application may call the list&#x2019;s append() method to add an element. &#xA0;This new element is part of the Persistent instance state, and it has changed, but the Persistent class has not been notified. &#xA0;This is bad because the next commit will not save the new version. &#xA0;In this situation, the program must explicitly tell the Persistent instance that a change has been made: &#xA0;the method for doing this is _p_note_change().</span>
        <a href="#Footnote6" style="font-size: 7.92pt; vertical-align: 0.500000em; ">6</a>
        <span style="vertical-align: 0.000000em; "></span>
      </p>
      <p class="Section_Heading " style="vertical-align: 0.000000em; ">Customized Persistent Classes</p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">Applications can use instances of Persistent directly, but most applications will probably use instances of Persistent subclasses, equipped with methods that suit the application. &#xA0;To make your class persistent, just add Persistent to the list of base classes. &#xA0;To ensure proper behavior, you do need to make sure that changes to your instances always get the attention of the Persistent class. &#xA0;Most of the time, changes to instances involve setting attributes, and in these cases, there is nothing more for the programmer to do. &#xA0;If, however, a change is made to a non-Persistent container within a Persistent instance, the programmer </span>
        <span style="font-family: 'Helvetica-Oblique', 'Helvetica'; font-style: italic; line-height: 1.17; vertical-align: 0.000000em; ">must </span>
        <span style="vertical-align: 0.000000em; ">make sure that _p_note_change() is called.</span>
      </p>
      <p class="Body " style="vertical-align: 0.000000em; ">Durus includes several subclasses of Persistent that meet common needs. &#xA0;The PersistentList class (defined in durus.persistent_list) provides the usual list methods, with persistence taken care of automatically. &#xA0;If you keep items in a PersistentList rather than a plain non-persistent list, then you can call the append() method with the assurance that the change will be saved with the next commit() (except if an abort() comes first, of course). &#xA0; The source code for PersistentList is pretty simple: &#xA0;you might want to look at it as an example if you are planning on maintaining non-persistent containers on attributes of a Persistent instance.</p>
      <p class="Body " style="vertical-align: 0.000000em; ">Durus provides a dict-like subclass of Persistent called PersistentDict. &#xA0;Like PersistentList, the main purpose of PersistentDict is to provide a common data structure in a manner that participates in the persistence system without special treatment from the application programmer.</p>
      <p class="Body " style="vertical-align: 0.000000em; ">PersistentList and PersistentDict are alike, in that they hold their data internally on an attribute whose value is the basic type (list or dict). &#xA0;Because they are Persistent, the underlying data structures are loaded only on an as-needed basis. &#xA0;This is very useful if you have long lists, for example, that may not be used often. &#xA0;Most of the time, the actual contents of the list may remain pickled. &#xA0; When, however, you do access the elements of a PersistentList or PersistentDict for the first time, the entire contents of the list must be loaded. &#xA0;For really huge data sets, this might be slower than you would like. &#xA0; The problem is that the entire data set is contained in a single pickle.</p>
      <p class="Body " style="vertical-align: 0.000000em; ">The cost of these monolithic pickles is even higher when changes are made and saved. &#xA0;On every commit(), the pickle of the entire data set must be written to disk. &#xA0;Besides the potential of being slow, this can become a space problem because FileStorage simply appends every change to the end of the underlying file. &#xA0; If these changes happen very frequently, the underlying file might fill a disk.</p>
      <p class="Body " style="vertical-align: 0.000000em; ">This space issue is one reason Durus also provides a BTree class. &#xA0;A BTree acts pretty much like a dict, except that the underlying data is distributed among many smaller instances of a subclass of Persistent (called BNode). &#xA0;Because the data stored in a BTree is divided among many smaller persistent objects, it can be accessed without loading the entire data set (unlike PersistentDict or PersistentList). &#xA0;When you change an item in a BTree, it is usually only a small part of the BTree that is involved, so the total space required to record a change is relatively small. &#xA0;The space required for a change does not grow linearly with the number of items in the data set. &#xA0; This makes BTree more attractive for data sets that are large or for which changes are frequent.</p>
      <p class="Body " style="vertical-align: 0.000000em; ">The benefits of BTree do come at a cost, though, the code is much more complicated than it is for PersistentDict, and, once all of the data sets are loaded, accesses are slower. &#xA0;The MEMS Exchange application uses PersistentDict in most cases. &#xA0;</p>
      <p class="Section_Heading " style="vertical-align: 0.000000em; ">Computed Attributes</p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">Durus includes an unusual subclass of Persistent called ComputedAttribute. &#xA0;This class is unusual, for a Persistent instance, because it is specially designed to </span>
        <span style="font-family: 'Helvetica-Oblique', 'Helvetica'; font-style: italic; line-height: 1.17; vertical-align: 0.000000em; ">not</span>
        <span style="vertical-align: 0.000000em; "> save any state changes. &#xA0;The intended purpose is for a ComputedAttribute to act as a container for information derived from other Persistent instances. &#xA0;In cases like this, the ComputedAttribute is useful because it can hold the derived information without actually storing it in the database. &#xA0;Besides avoiding duplication, this makes it possible to maintain the consistency of derived data. &#xA0;</span>
      </p>
      <p class="Body " style="vertical-align: 0.000000em; ">For example, suppose A maintains information derived from B, and that another connection commits a change to B. &#xA0;The problem is that we need some way to know that A is no longer up-to-date in this connection and in every connection that has A loaded. &#xA0;This synchronization is possible if A is a ComputedAttribute, and if every method that changes B calls A&#x2019;s invalidate() method. &#xA0;The invalidate() method clears the derived information currently in A and also calls A&#x2019;s _p_note_change() method. &#xA0;The interesting effect of this is that, even though A has no state information to save, any versions of A that are held in caches in other connections will be flushed. &#xA0;In other words, a ComputedAttribute A&#x2019;s invalidate() method gives a client the ability to notify all other clients that their versions of A must be dropped and re-computed.</p>
      <p class="Section_Heading " style="vertical-align: 0.000000em; ">Maintenance</p>
      <p class="Body " style="vertical-align: 0.000000em; ">Every time a transaction is committed, Durus appends the corresponding set of pickles to the end of the file on disk. &#xA0;Over time, this file grows. &#xA0;Whenever a particular instance is included in a transaction, the pickle in the new transaction makes obsolete all preceding pickles of that instance. &#xA0;We recover the space used by these obsolete pickles, and thereby shrink the file, using the connection&#x2019;s pack() method.</p>
      <p class="Body " style="vertical-align: 0.000000em; ">Packing also provides garbage collection. &#xA0;It only keeps instances that can be reached by some sequence of references in instances, starting with the root.</p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">The durus command-line tool provides an easy option for packing a file: &#x201C;</span>
        <span style="color: #000000; font-family: 'Helvetica-Bold', 'Helvetica'; font-size: 12.00pt; font-style: normal; font-variant: normal; font-weight: bold; letter-spacing: 0; line-height: 1.17; text-decoration: none; text-transform: none; vertical-align: 0.000000em; " class="console ">durus -p</span>
        <span style="vertical-align: 0.000000em; ">&#x201D;. &#xA0;Use &#x201C;</span>
        <span style="color: #000000; font-family: 'Helvetica-Bold', 'Helvetica'; font-size: 12.00pt; font-style: normal; font-variant: normal; font-weight: bold; letter-spacing: 0; line-height: 1.17; text-decoration: none; text-transform: none; vertical-align: 0.000000em; " class="console ">durus -p --help</span>
        <span style="vertical-align: 0.000000em; ">&#x201D; to see the list of options for specifying the Storage that you want to pack. </span>
      </p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">Packing stops other clients from writing, copies all of the current pickles into another file, and then swaps the old and new files. &#xA0;Administrators should be aware that any other read/write connections will be locked out during the pack, which takes time proportional to the size of the packed version of the file. &#xA0; Packing should be done as needed.</span>
        <a href="#Footnote7" style="font-size: 7.92pt; vertical-align: 0.500000em; ">7</a>
        <span style="vertical-align: 0.000000em; "> &#xA0;The required frequency depends on the rate at which data is changing for the application, and on the total size of the pickles of the changed instances.</span>
      </p>
      <p class="Section_Heading " style="vertical-align: 0.000000em; ">Inspection Functions</p>
      <p class="Body " style="vertical-align: 0.000000em; ">The storage.py source file includes some functions that are useful for inspecting the contents of a Durus Storage. &#xA0;</p>
      <p class="Body " style="vertical-align: 0.000000em; ">One of these functions is get_census(), which takes a storage argument and returns a dictionary where each key is a class name, and the value gives the number of pickled instances of that class that are stored in the database. &#xA0;</p>
      <p class="Body " style="vertical-align: 0.000000em; ">The get_reference_index() function takes a storage argument and returns a dictionary where each key is an object identifier and the corresponding value is a list of identifiers for instances whose pickles contain references to the instance identified by the key.</p>
      <p class="Section_Heading " style="vertical-align: 0.000000em; ">Cache Management</p>
      <p class="Body " style="vertical-align: 0.000000em; ">Each Connection maintains a cache of instances. &#xA0;To control the amount of memory required by the cache, the cache forces some loaded instances into the ghost state as needed. &#xA0;Changing an instance to the ghost state saves memory because it clears the instance __dict__ .</p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">The cache manager traverses a fraction of the cache on every commit or abort call, ghost-ing instances that have not been used recently. &#xA0;Recent usage is indicated by a _p_touched value that is stored on every instance of Persistent. &#xA0;As the cache manager traverses an instance, it sets the _p_touched value to False. &#xA0;The Persistent class causes the _p_touched value to be set to True on every attribute access. &#xA0;When the cache manager gets around to traversing the same instance again, it uses the value of the _p_touched attribute to decide whether or not the instance has been used recently. &#xA0;If it has not been used recently, and if the cache is too big</span>
        <a href="#Footnote8" style="font-size: 7.92pt; vertical-align: 0.500000em; ">8</a>
        <span style="vertical-align: 0.000000em; ">, the instance is made into a ghost.</span>
      </p>
      <p class="Body " style="vertical-align: 0.000000em; ">The cache manager uses weak references to the instances so that they can be removed by the garbage collector when they are no longer referenced from anywhere else.</p>
      <p class="Section_Heading " style="vertical-align: 0.000000em; ">Limitations</p>
      <p class="Body " style="vertical-align: 0.000000em; ">A Durus storage server maintains a dictionary in memory that gives the file offset of the record for each instance identifier. &#xA0;As the number of saved instances grows, this index grows, so this could put a practical limit on the number of instances that can be supported by a Durus application. &#xA0;In an experiment on a Linux machine, the virtual memory required for a storage server appeared to grow linearly with the number of instances at a rate of less than 100 MB of virtual memory required for each addition of 1 million instances. &#xA0;At 5 million instances, the memory requirement was about 414 MB.</p>
      <p class="Body " style="vertical-align: 0.000000em; ">A Durus FileStorage builds the index on startup, so startup time will increase in proportion to the number of stored objects. &#xA0; This could be a limiting factor for some applications.</p>
      <p class="Body ">
        <span style="vertical-align: 0.000000em; ">The low-level file format used by FileStorage uses a 4 byte unsigned integer to store the length of a single instance record, so Durus will not behave well for instances whose pickles have 2</span>
        <span style="font-size: 7.92pt; vertical-align: 0.500000em; ">32</span>
        <span style="vertical-align: 0.000000em; "> or more bytes.</span>
      </p>
      <p class="Section_Heading " style="vertical-align: 0.000000em; ">License</p>
      <p class="Body " style="vertical-align: 0.000000em; ">The Durus 1.5 license terms are those of the CNRI open source license, which was used for Python itself before 2001, when Python development was hosted by CNRI. &#xA0;Because, I think, the terms say that questions about the license are governed by Virginia, this &#xA0;license is not considered to be GPL-compatible. &#xA0;The license is short and included in the LICENSE.txt file in the distribution. &#xA0;The next Durus release will probably use a license that is GPL-compatible.</p>
      <p class="Section_Heading "></p>
      <p class="Section_Heading " style="vertical-align: 0.000000em; ">The Distribution</p>
      <p style="padding-bottom: 0pt; vertical-align: 0.000000em; " class="Body ">Durus version 1.5 is available for download from</p>
    </div>
    <div style="margin : 0pt 18pt 0pt 18pt; ">
      <p style="padding-top: 0pt; " class="Body ">
        <a href="http://www.mems-exchange.org/software/durus/" style="color: #000099; text-decoration: underline; vertical-align: 0.000000em; ">http://www.mems-exchange.org/software/durus/</a>
        <span style="vertical-align: 0.000000em; "></span>
      </p>
      <p class="Body " style="vertical-align: 0.000000em; ">The source code is small: &#xA0;the compressed distribution file has only 35,511 &#xA0;bytes. &#xA0;The following table lists the source files, excluding documentation files and unit tests.</p>
      <div class="Body ">
        <table cellspacing="0" style="background-color: transparent; border-collapse: collapse; " class="Table">
          <tr>
            <th style="background-color: #b0b3b2; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Abstract_Heading ">Lines</p>
              </div>
            </th>
            <th style="background-color: #b0b3b2; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Abstract_Heading ">File</p>
              </div>
            </th>
            <th style="background-color: #b0b3b2; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Abstract_Heading ">Description</p>
              </div>
            </th>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">4</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">__init__.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; width: 260pt; " class="table_cell_style_default">&#xA0;</td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">295</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">btree.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Provides BTree.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">97</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">client.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Interactive client script. &#xA0;Used by the &#x201C;durus&#x201D; script.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">96</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">client_storage.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Provides ClientStorage.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">343</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">connection.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Provides Connection.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">93</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">convert_zodb.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Script to convert a ZODB file to a Durus file.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">72</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">error.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Provides DurusError classes.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">314</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">file_storage.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Provides FileStorage and TempFileStorage.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">34</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">logger.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Supports logging through the Python &#xA0;logging module.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">36</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">pack_storage.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">A script for packing a Durus file.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">205</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">persistent.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Provides Persistent and ComputedAttribute.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">120</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">persistent_dict.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Provides PersistentDict.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">147</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">persistent_list.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Provides PersistentList</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">86</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">run_durus.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Script for running a storage server. &#xA0;Used by the &#x201C;durus&#x201D; script.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">135</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">serialize.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Provides low-level classes dealing with pickles.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">27</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">setup.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Distutils installation script.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">84</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">storage.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Provides Storage.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">188</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">storage_server.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Provides StorageServer.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">28</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">utils.py</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Provides some low level conversion utilities.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">202</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">_persistent.c</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">Provides the C implementation of PersistentBase.</p>
              </div>
            </td>
          </tr>
          <tr>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 50pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; text-align: right; font-size: 9.00pt; " class="Body ">32</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 85pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">durus</p>
              </div>
            </td>
            <td style="background-color: transparent; border: 1.00pt #000000 solid; height: 22pt; vertical-align: middle; width: 260pt; " class="Normal table_cell_style_default">
              <div>
                <p style="margin-bottom: 0.000000pt; margin-top: 0.000000pt; padding-bottom: 0pt; padding-top: 0pt; font-size: 9.00pt; " class="Body ">The primary command-line script.</p>
              </div>
            </td>
          </tr>
        </table>
        <span style="vertical-align: 0.000000em; "></span>
      </div>
      <p class="Section_Heading " style="vertical-align: 0.000000em; ">Acknowledgments</p>
      <p class="Body " style="vertical-align: 0.000000em; ">The MEMS Exchange software team of early 2004 (Anton Benard, David Binger, Roger Masse, and Neil Schemenauer) developed Durus in the course of working on the project funded by DARPA contract #MDA972-03-1-0022. &#xA0; Neil Schemenauer initiated work on Durus and made it fast by, among many other things, writing the C implementation of the PersistentBase class. &#xA0;Currently (in early 2005) Neil Schemenauer and Anton Benard are working independently as contractors.</p>
      <p class="Body " style="vertical-align: 0.000000em; ">The Durus architecture follows that of the ZODB, and we thank Jim Fulton and the Zope Corporation for writing and releasing ZODB.</p>
      <p class="Body " style="vertical-align: 0.000000em;  visibility: hidden; ">&#xA0;</p>
      <p style="padding-bottom: 0pt; " class="Body "></p>
    </div>
    <div class="FootnoteRegion">
      <p style="padding-top: 0pt; " class="Footnote_Text ">
        <a name="Footnote1" style="font-size: 6.60pt; vertical-align: 0.500000em; " id="Footnote1">1</a>
        <span style="vertical-align: 0.000000em; ">&#xA0;In the MEMS Exchange application, we use Apache 1.3 with the mod_scgi module to make this happen. &#xA0;The cgi2scgi program, included in the mod_scgi distribution, is a convenient and portable alternative.</span>
      </p>
      <p class="Footnote_Text ">
        <a name="Footnote2" style="font-size: 6.60pt; vertical-align: 0.500000em; " id="Footnote2">2</a>
        <span style="vertical-align: 0.000000em; ">&#xA0;In the MEMS Exchange application, the request-handler processes use Quixote to build responses.</span>
      </p>
      <p class="Footnote_Text ">
        <a name="Footnote3" style="font-size: 6.60pt; vertical-align: 0.500000em; " id="Footnote3">3</a>
        <span style="vertical-align: 0.000000em; ">&#xA0;The StorageServer listens on a port, usually on the local interface.</span>
      </p>
      <p class="Footnote_Text ">
        <a name="Footnote4" style="font-size: 6.60pt; vertical-align: 0.500000em; " id="Footnote4">4</a>
        <span style="vertical-align: 0.000000em; ">&#xA0;In the MEMS Exchange application, the request is re-processed from the start several times if necessary, to see if the processing can be completed without a conflict</span>
      </p>
      <p class="Footnote_Text ">
        <a name="Footnote5" style="font-size: 6.60pt; vertical-align: 0.500000em; " id="Footnote5">5</a>
        <span style="vertical-align: 0.000000em; ">&#xA0;This transparent support for persistence is an extremely attractive feature of the ZODB architecture.</span>
      </p>
      <p class="Footnote_Text ">
        <a name="Footnote6" style="font-size: 6.60pt; vertical-align: 0.500000em; " id="Footnote6">6</a>
        <span style="vertical-align: 0.000000em; ">&#xA0;The ZODB also has a Persistent class that behaves similarly. &#xA0;In ZODB, the standard way to note change is by setting the value of the _p_changed attribute. &#xA0;The Durus Persistent class implements a _p_changed property so that &#x201C;self._p_changed = 1&#x201D; does the same thing as &#x201C;self._p_note_change()&#x201D;</span>
      </p>
      <p class="Footnote_Text ">
        <a name="Footnote7" style="font-size: 6.60pt; vertical-align: 0.500000em; " id="Footnote7">7</a>
        <span style="vertical-align: 0.000000em; ">&#xA0;The MEMS Exchange runs a cron job that packs the database once a week. &#xA0;Applications with more frequent commits might require more frequent packing.</span>
      </p>
      <p class="Footnote_Text ">
        <a name="Footnote8" style="font-size: 6.60pt; vertical-align: 0.500000em; " id="Footnote8">8</a>
        <span style="vertical-align: 0.000000em; ">&#xA0;The target size for the number of non-ghost instances can be set using a keyword on the Connection constructor, or by using the set_cache_size() method.</span>
      </p>
    </div>
  </body>
</html>
